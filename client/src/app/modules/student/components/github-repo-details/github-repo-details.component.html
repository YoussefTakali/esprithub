<div class="repository-dashboard" *ngIf="repository && !loading && !error">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-left">
      <button class="back-btn" (click)="goBack()">
        <i class="fas fa-arrow-left"></i>
        Back to Repositories
      </button>
      <div class="repo-info">
        <i class="fas fa-folder folder-icon"></i>
        <span class="repo-label">Public repository</span>
        <h1 class="repo-path">{{ repository.owner?.login }}/{{ repository.name }}</h1>
      </div>
    </div>
    <div class="header-right">
      <div class="header-actions">
        <!-- Buttons moved to branch selector area -->
      </div>
    </div>
  </div>

  <!-- View Commit History Button -->
  <div class="commit-history-section">
    <button class="view-commit-history-btn" (click)="showCommitHistoryView()">
      <i class="fas fa-history"></i>
      View Commit History
    </button>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <div class="nav-tabs">
      <button class="nav-tab"
              [class.active]="activeTab === 'code'"
              (click)="setActiveTab('code')">
        <i class="fas fa-code"></i>
        Code
      </button>
      <button class="nav-tab"
              [class.active]="activeTab === 'statistics'"
              (click)="setActiveTab('statistics')">
        <i class="fas fa-chart-line"></i>
        Statistics
      </button>
    </div>
  </div>

  <!-- Code View -->
  <div class="code-content" *ngIf="activeTab === 'code'">
    <!-- GitHub-style Repository Header -->
    <div class="github-repo-header">
      <div class="repo-actions-bar">
        <div class="branch-selector">
          <i class="fas fa-code-branch"></i>
          <span class="branch-label">Branch:</span>
          
          <!-- FIXED: Simplified branch selector without conflicting bindings -->
          <select class="github-branch-select"
                  [value]="currentBranch"
                  (change)="onBranchModelChange($any($event.target).value)"
                  [disabled]="branchSwitching">
            <option *ngFor="let branch of allBranchesComputed; trackBy: trackByBranchName"
                    [value]="branch.name"
                    [selected]="branch.name === currentBranch">
              {{ branch.name }}
            </option>
          </select>
        </div>
        
        <div class="action-buttons">
          <input type="file"
                 #fileInput
                 multiple
                 (change)="onFileSelect($event)"
                 style="display: none;">
          <button class="btn btn-danger" (click)="fileInput.click()">
            <i class="fas fa-plus"></i>
            Add file
          </button>
          <button class="btn btn-danger" (click)="openCloneModal()">
            <i class="fas fa-code"></i>
            Code
          </button>
        </div>
      </div>
    </div>

    <!-- Repository Layout Container -->
    <div class="repository-layout">
      <div class="main-content">
        <!-- File Browser -->
        <!-- Branch switching loading state -->
        <div *ngIf="branchSwitching" class="branch-loading-state">
          <div class="loading-content">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading files for branch: <strong>{{ currentBranch }}</strong></p>
          </div>
        </div>

        <!-- Detached Rounded Commit Banner - MOVED OUTSIDE file-browser -->
        <div class="detached-commit-banner" *ngIf="latestCommit && !branchSwitching">
          <img [src]="latestCommit.avatarUrl || getDefaultCommitterAvatar()"
               [alt]="latestCommit.author"
               class="commit-avatar-rounded">
          <span class="commit-message-rounded">{{ latestCommit.message }}</span>
          <span class="commit-date-rounded">{{ latestCommit.date }}</span>
        </div>

        <!-- File Browser -->
        <div class="file-browser">
          <!-- Upload progress overlay -->
          <div class="upload-progress-overlay" *ngIf="isUploading">
            <div class="upload-progress">
              <div class="upload-spinner">
                <i class="fas fa-spinner fa-spin"></i>
              </div>
              <h3>Uploading files...</h3>
              <p>Please wait while your files are being uploaded to the repository.</p>
            </div>
          </div>

          <!-- File List View -->
          <div *ngIf="!isViewingFile">
            <!-- GitHub-style File Table WITH Headers -->
            <div class="github-file-table" *ngIf="!branchSwitching">
              <div class="file-table-header">
                <div class="header-cell name-header">NAME</div>
                <div class="header-cell message-header">COMMIT MESSAGE</div>
                <div class="header-cell committer-header">COMMITTER</div>
                <div class="header-cell date-header">UPDATED</div>
              </div>
              <div class="file-table-body">
                <div class="file-row"
                     *ngFor="let file of repositoryFiles; trackBy: trackByFileName"
                     (click)="onFileClick(file)"
                     (keyup.enter)="onFileClick(file)"
                     tabindex="0"
                     role="button"
                     [attr.aria-label]="'Open ' + file.name">
                  <div class="file-cell name-cell">
                    <div class="file-icon">
                      <i [class]="getFileIcon(file.type)"
                         [style.color]="getFileIconColor(file.name, file.type)"></i>
                    </div>
                    <span class="file-name">{{ file.name }}</span>
                    <i class="fas fa-chevron-right file-arrow" *ngIf="file.type === 'folder'"></i>
                  </div>
                  <div class="file-cell message-cell">
                    <span class="file-commit-message">{{ file.message || 'Add files via upload' }}</span>
                  </div>
                  <div class="file-cell committer-cell">
                    <span class="file-committer-name">{{ file.committer }}</span>
                  </div>
                  <div class="file-cell date-cell">
                    <span class="file-date">{{ file.lastModified }}</span>
                  </div>
                </div>
              </div>
              
              <!-- Empty state when no files -->
              <div class="empty-file-state" *ngIf="repositoryFiles?.length === 0">
                <div class="empty-content">
                  <i class="fas fa-folder-open"></i>
                  <h3>No files found</h3>
                  <p>This branch appears to be empty or the files are still loading.</p>
                  <button class="btn btn-primary" (click)="refreshData()">
                    <i class="fas fa-refresh"></i>
                    Refresh
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Repository Description Section -->
          <div class="repository-description-section" *ngIf="!isViewingFile && !branchSwitching">
            <div class="description-header">
              <div class="description-title">
                <i class="fas fa-book"></i>
                <span>REPOSITORY DESCRIPTION</span>
              </div>
              <button class="btn btn-danger btn-sm" (click)="toggleDescriptionEdit()" *ngIf="!isEditingDescription">
                Edit
              </button>
            </div>
            <div class="description-content" *ngIf="!isEditingDescription">
              <div class="no-description" *ngIf="!repositoryDescription">
                <div class="readme-icon">
                  <i class="fas fa-book"></i>
                </div>
                <h3>Add a README</h3>
                <p class="no-description-subtitle">Help people interested in this repository understand your project by adding a README.</p>
                <button class="btn btn-success" (click)="toggleDescriptionEdit()">
                  Add a README
                </button>
              </div>
              <div class="description-text" *ngIf="repositoryDescription">
                <p>{{ repositoryDescription }}</p>
              </div>
            </div>
            <div class="description-edit" *ngIf="isEditingDescription">
              <!-- Markdown Toolbar -->
              <div class="markdown-toolbar">
                <div class="toolbar-group">
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('**', '**')" title="Bold">
                    <i class="fas fa-bold"></i>
                  </button>
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('*', '*')" title="Italic">
                    <i class="fas fa-italic"></i>
                  </button>
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('~~', '~~')" title="Strikethrough">
                    <i class="fas fa-strikethrough"></i>
                  </button>
                </div>
                <div class="toolbar-group">
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('# ', '')" title="Heading 1">
                    H1
                  </button>
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('## ', '')" title="Heading 2">
                    H2
                  </button>
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('### ', '')" title="Heading 3">
                    H3
                  </button>
                </div>
                <div class="toolbar-group">
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('- ', '')" title="Bullet List">
                    <i class="fas fa-list-ul"></i>
                  </button>
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('1. ', '')" title="Numbered List">
                    <i class="fas fa-list-ol"></i>
                  </button>
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('> ', '')" title="Quote">
                    <i class="fas fa-quote-right"></i>
                  </button>
                </div>
                <div class="toolbar-group">
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('`', '`')" title="Inline Code">
                    <i class="fas fa-code"></i>
                  </button>
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('```\n', '\n```')" title="Code Block">
                    <i class="fas fa-file-code"></i>
                  </button>
                  <button type="button" class="toolbar-btn" (click)="insertMarkdown('[', '](url)')" title="Link">
                    <i class="fas fa-link"></i>
                  </button>
                </div>
                <div class="toolbar-group">
                  <button type="button" class="toolbar-btn preview-btn"
                          (click)="togglePreview()"
                          [class.active]="showMarkdownPreview"
                          title="Toggle Preview">
                    <i class="fas fa-eye"></i>
                    Preview
                  </button>
                </div>
              </div>
              <!-- Editor/Preview Container -->
              <div class="editor-container">
                <div class="editor-tabs">
                  <button type="button"
                          class="tab-btn"
                          [class.active]="!showMarkdownPreview"
                          (click)="showMarkdownPreview = false">
                    <i class="fas fa-edit"></i> Write
                  </button>
                  <button type="button"
                          class="tab-btn"
                          [class.active]="showMarkdownPreview"
                          (click)="showMarkdownPreview = true">
                    <i class="fas fa-eye"></i> Preview
                  </button>
                </div>
                <!-- Textarea Editor -->
                <textarea
                  #descriptionTextarea
                  class="description-textarea"
                  [(ngModel)]="editingDescriptionText"
                  placeholder="Add a description to help others understand what this repository is about.&#10;&#10;You can use Markdown formatting:&#10;**bold text**&#10;*italic text*&#10;# Heading&#10;- List item&#10;`code`"
                  rows="8"
                  *ngIf="!showMarkdownPreview">
                </textarea>
                <!-- Markdown Preview -->
                <div class="markdown-preview" *ngIf="showMarkdownPreview">
                  <div class="preview-content" [innerHTML]="getMarkdownPreview()"></div>
                  <div class="preview-empty" *ngIf="!editingDescriptionText?.trim()">
                    <i class="fas fa-eye-slash"></i>
                    <p>Nothing to preview</p>
                    <small>Write some markdown text to see the preview</small>
                  </div>
                </div>
              </div>
              <div class="description-actions">
                <button class="btn btn-success" (click)="saveDescription()">
                  <i class="fas fa-save"></i> Save README
                </button>
                <button class="btn btn-secondary" (click)="cancelDescriptionEdit()">
                  <i class="fas fa-times"></i> Cancel
                </button>
              </div>
            </div>
          </div>

          <!-- File Content View -->
          <div *ngIf="isViewingFile" class="file-content-view">
            <div class="file-view-header">
              <div class="file-nav">
                <button class="back-btn" (click)="backToFiles()">
                  <i class="fas fa-arrow-left"></i>
                  Back to files
                </button>
                <span class="file-path">{{ currentViewingFile?.path }}</span>
              </div>
              <div class="file-actions">
                <button class="btn btn-secondary" (click)="downloadFile(currentViewingFile)">
                  <i class="fas fa-download"></i>
                  Download
                </button>
                <button class="btn btn-secondary"
                        (click)="startEditingFile()"
                        *ngIf="canEditFile(currentViewingFile?.name) && !isEditingFile">
                  <i class="fas fa-edit"></i>
                  Edit
                </button>
                <button class="btn btn-secondary" *ngIf="isEditingFile" (click)="cancelEditing()">
                  <i class="fas fa-times"></i>
                  Cancel
                </button>
                <button class="btn btn-primary"
                        *ngIf="isEditingFile"
                        (click)="saveFileChanges()"
                        [disabled]="isSavingFile">
                  <i class="fas fa-save"></i>
                  {{ isSavingFile ? 'Saving...' : 'Save Changes' }}
                </button>
                <button class="btn btn-secondary"
                        (click)="openReplaceModal()"
                        *ngIf="!isEditingFile">
                  <i class="fas fa-upload"></i>
                  Replace
                </button>
                <button class="btn btn-danger"
                        (click)="openDeleteModal()"
                        *ngIf="!isEditingFile">
                  <i class="fas fa-trash"></i>
                  Delete
                </button>
              </div>
            </div>
            <div class="file-content-container">
              <!-- Edit mode for text files -->
              <div *ngIf="isEditingFile && !isBinaryFile(currentViewingFile?.name)" class="edit-file-content">
                <div class="edit-form">
                  <div class="form-group">
                    <label for="commit-message-edit">Commit message:</label>
                    <input type="text"
                           id="commit-message-edit"
                           [(ngModel)]="editCommitMessage"
                           placeholder="Update file"
                           class="form-control">
                  </div>
                  <div class="form-group">
                    <label for="file-content-edit">File content:</label>
                    <textarea id="file-content-edit"
                              [(ngModel)]="editedFileContent"
                              class="file-editor"
                              rows="20"></textarea>
                  </div>
                </div>
              </div>
              <!-- View mode for text files -->
              <div *ngIf="!isEditingFile && !isBinaryFile(currentViewingFile?.name) && isTextFile(currentViewingFile?.name)" class="text-file-content">
                <pre><code [innerHTML]="fileContent"></code></pre>
              </div>
              <!-- Download message for non-previewable files -->
              <div *ngIf="!isEditingFile && !isBinaryFile(currentViewingFile?.name) && !isTextFile(currentViewingFile?.name)" class="download-message-content">
                <div class="download-message-info">
                  <i class="fas fa-download"></i>
                  <h3>{{ currentViewingFile?.name }}</h3>
                  <p>{{ fileContent }}</p>
                  <button class="btn btn-primary" (click)="downloadFile(currentViewingFile)">
                    <i class="fas fa-download"></i>
                    Download File
                  </button>
                </div>
              </div>
              <!-- FIXED: Image file content with proper error handling -->
              <div *ngIf="isImageFile(currentViewingFile?.name)" class="image-file-content">
                <div class="image-container">
                  <!-- Image with proper error handling -->
                  <img
                     [src]="getImageSrc(currentViewingFile)"
                    [alt]="currentViewingFile?.name"
                    crossorigin="anonymous"
                    (load)="onImageLoad($event)"
                    (error)="onImageError($event)"
                    class="repository-image"
                    style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px;"
                    *ngIf="!imageLoadError">
                                                                                      
                  <!-- Error fallback -->
                  <div *ngIf="imageLoadError" class="image-error text-center p-4">
                    <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                    <h5>Unable to load image</h5>
                    <p class="text-muted mb-3">{{ currentViewingFile?.name }}</p>
                    <p class="small text-muted mb-3">
                      This may be due to:
                      <br>• Special characters in the filename
                      <br>• CORS restrictions
                      <br>• File not found in the repository
                    </p>
                    <div class="d-flex justify-content-center gap-2">
                      <button class="btn btn-primary btn-sm" (click)="downloadFile(currentViewingFile)">
                        <i class="fas fa-download"></i> Download Image
                      </button>
                      <button class="btn btn-secondary btn-sm" (click)="resetImageError()">
                        <i class="fas fa-redo"></i> Retry
                      </button>
                    </div>
                    <div class="mt-3">
                      <small class="text-muted">
                        <strong>URL:</strong>
                         <a [href]="getFileDownloadUrl(currentViewingFile)" target="_blank" class="text-break">
                          {{ getFileDownloadUrl(currentViewingFile) }}
                        </a>
                      </small>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Binary file content -->
              <div *ngIf="isBinaryFile(currentViewingFile?.name) && !isImageFile(currentViewingFile?.name)" class="binary-file-content">
                <div class="binary-file-info">
                  <i class="fas fa-file"></i>
                  <h3>{{ currentViewingFile?.name }}</h3>
                  <p>This is a binary file and cannot be displayed.</p>
                  <button class="btn btn-primary" (click)="downloadFile(currentViewingFile)">
                    <i class="fas fa-download"></i>
                    Download File
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- File Actions for Selected File -->
        <div class="file-actions-bar" *ngIf="!showFileContent && !showCommitDetails">
          <div class="file-action-buttons">
            <button class="action-btn btn-view" *ngIf="selectedFile">
              <i class="fas fa-eye"></i>
              View
            </button>
            <button class="action-btn btn-edit" *ngIf="selectedFile">
              <i class="fas fa-edit"></i>
              Edit
            </button>
            <button class="action-btn btn-download" *ngIf="selectedFile">
              <i class="fas fa-download"></i>
              Download
            </button>
            <button class="action-btn btn-replace" *ngIf="selectedFile">
              <i class="fas fa-upload"></i>
              Replace
            </button>
            <button class="action-btn btn-delete" *ngIf="selectedFile">
              <i class="fas fa-trash"></i>
              Delete
            </button>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Contributors -->
        <div class="sidebar-section contributors-section">
          <h3>Contributors <span class="contributors-count-badge">{{ getAllContributors().length || 1 }}</span></h3>
          <div class="contributors-list">
            <div class="contributor" *ngFor="let contributor of getAllContributors(); let i = index">
              <img [src]="contributor.avatar"
                   [alt]="contributor.name"
                   class="contributor-avatar"
                   (error)="onContributorAvatarError($event, contributor.name)">
              <div class="contributor-info">
                <span class="contributor-name">{{ contributor.name }}</span>
                <span class="contributor-commits">{{ contributor.commits }} commits</span>
              </div>
            </div>
            <!-- Default contributor if none exist -->
            <div class="contributor" *ngIf="getAllContributors().length === 0">
              <img [src]="getDefaultCommitterAvatar()"
                   [alt]="getDefaultCommitter()"
                   class="contributor-avatar"
                   (error)="onDefaultContributorAvatarError($event)">
              <div class="contributor-info">
                <span class="contributor-name">{{ getDefaultCommitter() }}</span>
                <span class="contributor-commits">{{ getTotalCommits() }} commits</span>
              </div>
            </div>
          </div>
        </div>

        <!-- File Types -->
        <div class="sidebar-section file-types-section">
          <h3>File Types</h3>
          <div class="file-types-chart">
            <div class="file-type-bar">
              <div class="file-type-segment"
                   *ngFor="let lang of getLanguageArray()"
                   [style.width.%]="lang.percentage"
                   [style.background-color]="lang.color"
                   [title]="lang.name + ' ' + lang.percentage + '%'">
              </div>
            </div>
            <div class="file-type-list">
              <div class="file-type-item" *ngFor="let lang of getLanguageArray()">
                <div class="file-type-color" [style.background-color]="lang.color"></div>
                <span class="file-type-name">{{ lang.name }}</span>
                <span class="file-type-percentage">{{ lang.percentage.toFixed(1) }}%</span>
              </div>
              <!-- REMOVED: Default file types when none exist -->
              <div class="no-file-types" *ngIf="getLanguageArray().length === 0">
                <div class="empty-content">
                  <i class="fas fa-code"></i>
                  <p>No file types detected</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End Sidebar -->
    </div>
    <!-- End Repository Layout -->
  </div>

  <!-- ENHANCED Repository Dashboard (Statistics) -->
  <div class="repo-dashboard-content" *ngIf="activeTab === 'statistics'">
    <div class="dashboard-title">
      <h2>Repository Statistics</h2>
      <span class="repo-path-subtitle">{{ repository.owner?.login }}/{{ repository.name }}</span>
      <button class="refresh-btn" (click)="refreshData()">
        <i class="fas fa-sync-alt"></i>
        Refresh
      </button>
    </div>

    <!-- Main Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon contributors">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <span class="stat-number">{{ dashboardStats.contributors }}</span>
          <span class="stat-label">CONTRIBUTORS</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon total-commits">
          <i class="fas fa-code-branch"></i>
        </div>
        <div class="stat-content">
          <span class="stat-number">{{ dashboardStats.totalCommits }}</span>
          <span class="stat-label">TOTAL COMMITS</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon total-files">
          <i class="fas fa-file"></i>
        </div>
        <div class="stat-content">
          <span class="stat-number">{{ dashboardStats.totalFiles }}</span>
          <span class="stat-label">TOTAL FILES</span>
        </div>
      </div>
    </div>

    <!-- Statistics Grid Layout -->
    <div class="statistics-grid">
      <!-- Left Column -->
      <div class="statistics-left-column">
        
        <!-- Branch Statistics -->
        <div class="statistics-card">
          <div class="card-header">
            <h3>
              <i class="fas fa-code-branch"></i>
              Branch Statistics
            </h3>
          </div>
          <div class="card-content">
            <div class="branch-stats-list">
              <div class="branch-stat-item" *ngFor="let branch of allBranchesComputed">
                <div class="branch-info">
                  <div class="branch-name-section">
                    <i class="fas fa-code-branch branch-icon"></i>
                    <span class="branch-name">{{ branch.name }}</span>
                    <span class="current-badge" *ngIf="branch.name === currentBranch">Current</span>
                  </div>
                  <div class="branch-stats">
                    <span class="file-count">{{ getBranchFileCount(branch.name) }} files</span>
                    <span class="last-commit" *ngIf="getBranchLastCommit(branch.name)">
                      Last commit: {{ getBranchLastCommit(branch.name) }}
                    </span>
                  </div>
                </div>
                <div class="branch-actions">
                  <button class="btn btn-sm btn-outline"
                           (click)="switchToBranch(branch.name)"
                          [disabled]="branch.name === currentBranch">
                    <i class="fas fa-eye"></i>
                    View
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Daily Commits Chart -->
        <div class="statistics-card">
          <div class="card-header">
            <h3>
              <i class="fas fa-calendar-alt"></i>
              Daily Commits (Last 7 Days)
            </h3>
          </div>
          <div class="card-content">
            <div class="daily-commits-chart">
              <div class="commits-chart-container">
                <div class="commit-day" *ngFor="let day of getDailyCommits()">
                  <div class="commit-bar">
                    <div class="commit-fill"
                         [style.height.%]="day.percentage"
                         [style.background-color]="getCommitColor(day.count)"
                         [title]="day.count + ' commits on ' + day.date">
                    </div>
                  </div>
                  <div class="commit-count">{{ day.count }}</div>
                  <div class="commit-date">{{ day.date }}</div>
                </div>
              </div>
              <div class="commits-summary">
                <div class="summary-item">
                  <span class="summary-label">Total (7 days):</span>
                  <span class="summary-value">{{ getTotalCommitsLast7Days() }}</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Average per day:</span>
                  <span class="summary-value">{{ getAverageCommitsPerDay() }}</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Most active day:</span>
                  <span class="summary-value">{{ getMostActiveDay() }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="statistics-right-column">
        
        <!-- Contributors Statistics -->
        <div class="statistics-card">
          <div class="card-header">
            <h3>
              <i class="fas fa-users"></i>
              Contributors ({{ getAllContributors().length }})
            </h3>
          </div>
          <div class="card-content">
            <div class="contributors-stats-list">
              <div class="contributor-stat-item" *ngFor="let contributor of getAllContributors(); let i = index">
                <div class="contributor-rank">{{ i + 1 }}</div>
                <div class="contributor-avatar-section">
                  <img [src]="contributor.avatar"
                       [alt]="contributor.name"
                       class="contributor-avatar-large"
                       (error)="onContributorAvatarError($event, contributor.name)">
                </div>
                <div class="contributor-details">
                  <div class="contributor-name-large">{{ contributor.name }}</div>
                  <div class="contributor-stats-details">
                    <span class="commits-count">{{ contributor.commits }} commits</span>
                    <span class="contribution-percentage">{{ getContributorPercentage(contributor.commits) }}%</span>
                  </div>
                </div>
                <div class="contribution-bar">
                  <div class="contribution-fill"
                        [style.width.%]="getContributorPercentage(contributor.commits)"
                       [style.background-color]="getContributorColor(i)">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- File Types Distribution -->
        <div class="statistics-card">
          <div class="card-header">
            <h3>
              <i class="fas fa-file-code"></i>
              File Types Distribution
            </h3>
          </div>
          <div class="card-content">
            <div class="file-types-distribution">
              <!-- File Types Chart -->
              <div class="file-types-chart-large" *ngIf="getLanguageArray().length > 0">
                <div class="file-type-bar-large">
                  <div class="file-type-segment-large"
                       *ngFor="let lang of getLanguageArray()"
                       [style.width.%]="lang.percentage"
                       [style.background-color]="lang.color"
                       [title]="lang.name + ': ' + lang.percentage + '%'">
                  </div>
                </div>
              </div>
              
              <!-- File Types List -->
              <div class="file-types-list-large" *ngIf="getLanguageArray().length > 0">
                <div class="file-type-item-large" *ngFor="let lang of getLanguageArray(); let i = index">
                  <div class="file-type-rank">{{ i + 1 }}</div>
                  <div class="file-type-color-large" [style.background-color]="lang.color"></div>
                  <div class="file-type-details">
                    <div class="file-type-name-large">{{ lang.name }}</div>
                    <div class="file-type-stats">
                      <span class="file-type-percentage-large">{{ lang.percentage.toFixed(1) }}%</span>
                      <span class="file-type-size" *ngIf="lang.bytes">{{ formatFileSize(lang.bytes) }}</span>
                    </div>
                  </div>
                  <div class="file-type-bar-small">
                    <div class="file-type-fill-small"
                          [style.width.%]="lang.percentage"
                         [style.background-color]="lang.color">
                    </div>
                  </div>
                </div>
              </div>
              <!-- REMOVED: Default file types fallback -->
              <div class="no-file-types-large" *ngIf="getLanguageArray().length === 0">
                <div class="empty-content">
                  <i class="fas fa-code"></i>
                  <h4>No file types detected</h4>
                  <p>Upload some files to see the file type distribution.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- REMOVED: Enhanced Daily Activity Chart section has been deleted -->
    
  </div>
</div>

<!-- All the modals remain the same... -->
<!-- Upload File Modal -->
<div class="modal-overlay" *ngIf="showUploadModal"
     (click)="closeUploadModal()"
     (keydown.escape)="closeUploadModal()">
  <div class="upload-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-plus"></i> Add files to {{ repository?.name }}</h3>
      <button class="close-btn" (click)="closeUploadModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="upload-branch">Branch:</label>
        <select id="upload-branch"
                [(ngModel)]="selectedUploadBranch"
                class="form-control">
          <option [value]="repository.defaultBranch || 'main'">{{ repository.defaultBranch || 'main' }}</option>
          <option *ngFor="let branch of branches; trackBy: trackByBranchName" [value]="branch.name">{{ branch.name }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="commit-message">Commit message:</label>
        <input type="text"
               id="commit-message"
               [(ngModel)]="uploadCommitMessage"
               placeholder="Add files via upload"
               class="form-control">
      </div>
      <div class="form-group">
        <label>Selected files:</label>
        <div class="file-preview">
          <div *ngIf="selectedFiles.length === 0" class="no-files">
            <p>No files selected</p>
            <input type="file"
                   #modalFileInput
                   multiple
                   (change)="onModalFileSelect($event)"
                   style="display: none;">
            <button type="button" class="btn btn-secondary" (click)="modalFileInput.click()">
              <i class="fas fa-folder-open"></i>
              Choose Files
            </button>
          </div>
          <div *ngIf="selectedFiles.length > 0" class="files-list">
            <div *ngFor="let file of selectedFiles" class="file-item-preview">
              <i class="fas fa-file"></i>
              {{ file.name }} ({{ formatFileSize(file.size) }})
            </div>
          </div>
        </div>
      </div>
      <div class="selected-files" *ngIf="selectedFiles.length > 0">
        <h4>Selected Files:</h4>
        <ul>
          <li *ngFor="let file of selectedFiles">{{ file.name }} ({{ formatFileSize(file.size) }})</li>
        </ul>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeUploadModal()">Cancel</button>
      <button class="btn btn-primary"
              (click)="uploadSelectedFiles()"
              [disabled]="selectedFiles.length === 0 || isUploading">
        <i class="fas fa-upload"></i>
        {{ isUploading ? 'Uploading...' : 'Upload Files' }}
      </button>
    </div>
  </div>
</div>

<!-- Replace File Modal -->
<div class="modal-overlay" *ngIf="showReplaceModal"
     (click)="closeReplaceModal()"
     (keydown.escape)="closeReplaceModal()">
  <div class="upload-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-upload"></i> Replace {{ currentViewingFile?.name }}</h3>
      <button class="close-btn" (click)="closeReplaceModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="replace-commit-message">Commit message:</label>
        <input type="text"
               id="replace-commit-message"
               [(ngModel)]="replaceCommitMessage"
               placeholder="Replace file"
               class="form-control">
      </div>
      <div class="form-group">
        <label for="replace-file-input">Choose replacement file:</label>
        <input type="file"
               id="replace-file-input"
               (change)="onReplaceFileSelect($event)"
               class="form-control">
      </div>
      <div class="selected-files" *ngIf="selectedReplaceFile">
        <h4>Selected File:</h4>
        <div class="file-item-preview">
          <i class="fas fa-file"></i>
          {{ selectedReplaceFile.name }} ({{ formatFileSize(selectedReplaceFile.size) }})
        </div>
        <div class="file-warning" *ngIf="selectedReplaceFile.name !== currentViewingFile?.name">
          <i class="fas fa-exclamation-triangle"></i>
          <span>Warning: The selected file has a different name than the original file.</span>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeReplaceModal()">Cancel</button>
      <button class="btn btn-primary"
              (click)="replaceFile()"
              [disabled]="!selectedReplaceFile || isReplacingFile">
        <i class="fas fa-upload"></i>
        {{ isReplacingFile ? 'Replacing..' : 'Replace File' }}
      </button>
    </div>
  </div>
</div>

<!-- Delete File Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal"
     (click)="closeDeleteModal()"
     (keydown.escape)="closeDeleteModal()">
  <div class="upload-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-trash"></i> Delete {{ currentViewingFile?.name }}</h3>
      <button class="close-btn" (click)="closeDeleteModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="delete-warning">
        <i class="fas fa-exclamation-triangle"></i>
        <p><strong>Warning:</strong> This action cannot be undone. This will permanently delete the file from the repository.</p>
      </div>
      <div class="form-group">
        <label for="delete-commit-message">Commit message:</label>
        <input type="text"
               id="delete-commit-message"
               [(ngModel)]="deleteCommitMessage"
               placeholder="Delete file"
               class="form-control">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
      <button class="btn btn-danger"
              (click)="deleteFile()"
              [disabled]="!deleteCommitMessage.trim() || isDeletingFile">
        <i class="fas fa-trash"></i>
        {{ isDeletingFile ? 'Deleting...' : 'Delete File' }}
      </button>
    </div>
  </div>
</div>

<!-- Clone Modal -->
<div class="modal-overlay" *ngIf="showCloneModal"
     (click)="closeCloneModal()"
     (keydown.escape)="closeCloneModal()"
     role="dialog"
     aria-modal="true"
     aria-labelledby="clone-modal-title">
  <div class="clone-modal" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 id="clone-modal-title"><i class="fas fa-download"></i> Clone or download this repository</h3>
      <button class="close-btn" (click)="closeCloneModal()" aria-label="Close modal">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-content">
      <div class="clone-section">
        <h4><i class="fas fa-link"></i> Clone with HTTPS</h4>
        <p class="clone-description">Use Git or checkout with SVN using the web URL.</p>
        <div class="clone-url-container">
          <input type="text"
                 [value]="repository.cloneUrl || 'https://github.com/' + (repository.owner?.login || repository.fullName?.split('/')[0]) + '/' + (repository.name || repository.fullName?.split('/')[1]) + '.git'"
                 readonly
                 class="clone-url-input">
          <button class="copy-btn"
                  (click)="copyToClipboard(repository.cloneUrl || 'https://github.com/' + (repository.owner?.login || repository.fullName?.split('/')[0]) + '/' + (repository.name || repository.fullName?.split('/')[1]) + '.git')">
            <i class="fas fa-copy"></i>
            Copy
          </button>
        </div>
      </div>
      
      <div class="download-section">
        <h4><i class="fas fa-download"></i> Download ZIP</h4>
        <button class="download-zip-btn" (click)="downloadZip()">
          <i class="fas fa-download"></i>
          Download ZIP ({{ currentBranch }} branch)
        </button>
        <p class="download-note">
          <i class="fas fa-info-circle"></i>
          Try direct GitHub download if the above doesn't work
        </p>
      </div>
    </div>
  </div>
</div>

<!-- File Content View Modal -->
<div class="modal-overlay" *ngIf="showFileContent"
     (click)="closeFileView()"
     (keydown.escape)="closeFileView()"
     role="dialog"
     aria-modal="true"
     aria-labelledby="file-modal-title">
  <div class="file-content-modal" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()">
    <div class="file-header">
      <div class="file-path">
        <button class="back-btn" (click)="closeFileView()">
          <i class="fas fa-arrow-left"></i>
          Back to files
        </button>
        <span id="file-modal-title" class="file-name">{{ selectedFile?.name }}</span>
      </div>
      <div class="file-actions">
        <button class="btn-raw">Raw</button>
        <button class="btn-download">
          <i class="fas fa-download"></i>
          Download
        </button>
        <button class="btn-edit">
          <i class="fas fa-edit"></i>
          Edit
        </button>
        <button class="btn-replace">
          <i class="fas fa-upload"></i>
          Replace
        </button>
        <button class="btn-delete">
          <i class="fas fa-trash"></i>
          Delete
        </button>
      </div>
    </div>
    
    <div class="file-content">
      <!-- Image preview for image files -->
      <div class="image-preview" *ngIf="selectedFile && isImageFile(selectedFile.name)">
        <img [src]="getImageSrc(selectedFile)"
             [alt]="selectedFile.name"
             class="preview-image"
             [style.display]="imageLoadError ? 'none' : 'block'">
        <div class="image-error" [style.display]="imageLoadError ? 'block' : 'none'">
          <i class="fas fa-exclamation-triangle"></i>
          <p>Unable to load image preview</p>
        </div>
        <div class="image-info">
          <p><strong>File:</strong> {{ selectedFile.name }}</p>
          <p><strong>Size:</strong> {{ selectedFile.sizeFormatted }}</p>
          <p *ngIf="selectedFile.lastModified"><strong>Last Modified:</strong> {{ selectedFile.lastModified }}</p>
        </div>
      </div>
      
      <!-- Binary file notice -->
      <div class="binary-file-preview" *ngIf="selectedFile && isBinaryFile(selectedFile.name) && !isImageFile(selectedFile.name)">
        <i class="fas fa-file-archive"></i>
        <h3>Binary File</h3>
        <p>This is a binary file and cannot be displayed as text.</p>
        <div class="image-info">
          <p><strong>File:</strong> {{ selectedFile.name }}</p>
          <p><strong>Size:</strong> {{ selectedFile.sizeFormatted }}</p>
          <p *ngIf="selectedFile.lastModified"><strong>Last Modified:</strong> {{ selectedFile.lastModified }}</p>
        </div>
        <a [href]="selectedFile.downloadUrl"
           class="download-binary-btn"
           target="_blank"
           *ngIf="selectedFile.downloadUrl">
          <i class="fas fa-download"></i>
          Download File
        </a>
      </div>
      
      <!-- Text content for text files -->
      <div class="text-content" *ngIf="selectedFile && !isBinaryFile(selectedFile.name)">
        <div class="line-numbers">
          <div class="line-number" *ngFor="let line of fileContent.split('\n'); let i = index">{{ i + 1 }}</div>
        </div>
        <div class="file-code-content">
          <pre><code>{{ fileContent }}</code></pre>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="loading" class="loading-state">
  <div class="loading-spinner">
    <i class="fas fa-spinner fa-spin"></i>
  </div>
  <p>Loading repository details...</p>
</div>

<!-- Error State -->
<div *ngIf="error && !loading" class="error-state">
  <div class="error-icon">
    <i class="fas fa-exclamation-triangle"></i>
  </div>
  <h3>Error Loading Repository</h3>
  <p>{{ error }}</p>
  <button class="btn-retry" (click)="goBack()">Go Back</button>
</div>