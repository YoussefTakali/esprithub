<!-- Template will be based on your provided classes.component.html, adapted for teacher's view -->
<span></span>
<div class="task-management-container">
  <!-- Sidebar and main content for teacher's tasks page, adapted from classes.component.html -->
  <div class="task-management-container">
    <div class="sidebar">
      <h2 class="sidebar-title">My Classes & Projects</h2>
      <div class="tree-view">
        <div *ngFor="let classe of teacherClasses" class="tree-item">
          <div class="tree-node class-node" [class.expanded]="classe.expanded">
            <button class="tree-icon arrow-icon" (click)="toggleClass(classe)">
              <i class="fas" [class.fa-chevron-right]="!classe.expanded" [class.fa-chevron-down]="classe.expanded"></i>
            </button>
            <span class="tree-icon">
              <i class="fas fa-graduation-cap"></i>
            </span>
            <span class="tree-label">
              {{ classe.name || classe.className }}
              <span *ngIf="classe.courseName" class="course-name">({{ classe.courseName }})</span>
            </span>
          </div>
          <div *ngIf="classe.expanded" class="tree-children">
            <div *ngFor="let project of classe.projects" class="tree-item">
              <div class="tree-node project-node" [class.selected]="selectedProject?.id === project.id" [class.expanded]="project.expanded">
                <button class="tree-icon arrow-icon" (click)="toggleProject(project)">
                  <i class="fas" [class.fa-chevron-right]="!project.expanded" [class.fa-chevron-down]="project.expanded"></i>
                </button>
                <span class="tree-icon">
                  <i class="fas fa-folder"></i>
                </span>
                <button class="tree-label" (click)="selectProject(project)">{{ project.name }}</button>
                <button class="add-icon" (click)="openCreateGroupModal(project, classe.classId)">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
              <div *ngIf="project.expanded" class="tree-children">
                <div *ngFor="let group of project.groups" class="tree-item">
                  <div class="tree-node group-node" [class.expanded]="group.expanded">
                    <button class="tree-icon arrow-icon" (click)="toggleGroup(group)">
                      <i class="fas" [class.fa-chevron-right]="!group.expanded" [class.fa-chevron-down]="group.expanded"></i>
                    </button>
                    <span class="tree-icon">
                      <i class="fas fa-users"></i>
                    </span>
                    <button class="tree-label" (click)="filterByGroup(group)">
                      {{ group.name }}
                    </button>
                    <button class="add-icon" (click)="openAddMemberModal(group)">
                      <i class="fas fa-plus"></i>
                    </button>
                    <button class="remove-icon" (click)="confirmRemoveGroup(group)">
                      <i class="fas fa-minus"></i>
                    </button>
                  </div>
                  <div *ngIf="group.expanded" class="tree-children">
                    <div *ngFor="let studentId of group.memberIds" class="tree-item">
                      <div class="tree-node student-node">
                        <span class="tree-icon">
                          <i class="fas fa-user"></i>
                        </span>
                        <button class="tree-label" (click)="filterByStudent(studentId)">
                          {{ getStudentName(studentId) }}
                        </button>
                        <button class="remove-icon" (click)="confirmRemoveMember(group, studentId)">
                          <i class="fas fa-minus-circle"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Main Content - Task list -->
    <div class="main-content">
      <div class="content-header">
        <h1 class="content-title">Tasks for {{ selectedProject?.name || 'All Projects' }}</h1>
        <div class="header-actions">
          <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" 
                   placeholder="Search tasks..." 
                   class="search-input"
                   [(ngModel)]="searchTerm">
          </div>
          <button class="add-task-btn" (click)="addTask()">
            <i class="fas fa-plus"></i>
            Add Task
          </button>
        </div>
      </div>
      <div class="task-grid">
        <div *ngFor="let task of filteredTasks" class="task-card">
          <!-- ...task card content as in your design... -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Create Group Modal -->
<div class="modal-backdrop" *ngIf="showCreateGroupModal" (click)="closeCreateGroupModal()" (keydown.escape)="closeCreateGroupModal()"></div>
<div class="modal" *ngIf="showCreateGroupModal">
  <div class="modal-content" (click)="$event.stopPropagation()" (keydown.escape)="closeCreateGroupModal()">
    <h3 style="color:#e74c3c">Create New Group</h3>
    <form (ngSubmit)="createGroupSubmit()">
      <label for="groupName">Group Name</label>
      <input id="groupName" [(ngModel)]="groupNameInput" name="groupNameInput" required placeholder="Group Name" />
      <label for="groupMembers">Members</label>
      <input id="groupMembers" [(ngModel)]="groupMembersInput" name="groupMembersInput" placeholder="Type name or email to add..." (input)="onGroupMemberInput()" autocomplete="off" />
      <ul *ngIf="groupMemberSuggestions.length > 0" class="autocomplete-list">
        <li *ngFor="let user of groupMemberSuggestions">
          <button type="button" (click)="selectGroupMember(user)">
            <div><b>{{ user.fullName || user.name || user.email }}</b></div>
            <div style="font-size:12px;color:#888">{{ user.email }}</div>
          </button>
        </li>
      </ul>
      <div class="selected-collaborators">
        <span *ngFor="let m of selectedGroupMembers">
          {{ m.fullName || m.name || m.email }}
          <button type="button" (click)="removeGroupMember(m.id)">&times;</button>
        </span>
      </div>
      <div class="modal-actions">
        <button class="create-btn-red" type="submit">Create</button>
        <button class="cancel-btn" type="button" (click)="closeCreateGroupModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>
<!-- Add Member Modal -->
<div class="modal-backdrop" *ngIf="showAddMemberModal" (click)="closeAddMemberModal()" (keydown.escape)="closeAddMemberModal()"></div>
<div class="modal" *ngIf="showAddMemberModal">
  <div class="modal-content" (click)="$event.stopPropagation()" (keydown.escape)="closeAddMemberModal()">
    <h3 style="color:#e74c3c">Add Member to Group</h3>
    <label for="addMember">Member</label>
    <input id="addMember" [(ngModel)]="addMemberInput" name="addMemberInput" placeholder="Type name or email..." (input)="onAddMemberInput()" autocomplete="off" />
    <ul *ngIf="addMemberSuggestions.length > 0" class="autocomplete-list">
      <li *ngFor="let user of addMemberSuggestions">
        <button type="button" (click)="selectAddMember(user)">
          <div><b>{{ user.fullName || user.name || user.email }}</b></div>
          <div style="font-size:12px;color:#888">{{ user.email }}</div>
        </button>
      </li>
    </ul>
    <div class="modal-actions">
      <button class="cancel-btn" type="button" (click)="closeAddMemberModal()">Cancel</button>
    </div>
  </div>
</div>
<!-- Remove Group Modal -->
<div class="modal-backdrop" *ngIf="showRemoveGroupModal" (click)="closeRemoveGroupModal()" (keydown.escape)="closeRemoveGroupModal()"></div>
<div class="modal" *ngIf="showRemoveGroupModal">
  <div class="modal-content" (click)="$event.stopPropagation()" (keydown.escape)="closeRemoveGroupModal()">
    <h3 style="color:#e74c3c">Confirm Delete</h3>
    <div style="margin-bottom: 16px;">Are you sure you want to delete the group <b>{{ groupToDelete?.name }}</b>?</div>
    <div class="modal-actions">
      <button class="create-btn-red" (click)="removeGroupSubmit()">Delete</button>
      <button class="cancel-btn" (click)="closeRemoveGroupModal()">Cancel</button>
    </div>
  </div>
</div>
<!-- Remove Member Modal -->
<div class="modal-backdrop" *ngIf="showRemoveMemberModal" (click)="closeRemoveMemberModal()" (keydown.escape)="closeRemoveMemberModal()"></div>
<div class="modal" *ngIf="showRemoveMemberModal">
  <div class="modal-content" (click)="$event.stopPropagation()" (keydown.escape)="closeRemoveMemberModal()">
    <h3 style="color:#e74c3c">Remove Member</h3>
    <div style="margin-bottom: 16px;">Are you sure you want to remove <b>{{ getStudentName(memberToRemove) }}</b> from group <b>{{ groupToRemoveMember?.name }}</b>?</div>
    <div class="modal-actions">
      <button class="create-btn-red" (click)="removeMemberSubmit()">Remove</button>
      <button class="cancel-btn" (click)="closeRemoveMemberModal()">Cancel</button>
    </div>
  </div>
</div>
