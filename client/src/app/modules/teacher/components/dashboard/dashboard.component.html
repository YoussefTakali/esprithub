<div class="teacher-dashboard">

  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>Teacher Dashboard</h1>
      <p>Welcome! Here is an overview of your activity.</p>
    </div>
    <button class="refresh-btn" (click)="ngOnInit()" title="Refresh">
      <i class="fas fa-sync-alt"></i>
      Refresh
    </button>
  </div>

  <!-- Main statistics -->
  <div class="stats-grid">
    <div class="stat-card projects">
      <div class="stat-icon"><i class="fas fa-folder-open"></i></div>
      <div class="stat-content">
        <h3>{{ myProjects.length }}</h3>
        <p>Projects</p>
      </div>
    </div>
    <div class="stat-card groups">
      <div class="stat-icon"><i class="fas fa-users"></i></div>
      <div class="stat-content">
        <h3>{{ myGroups.length }}</h3>
        <p>Groups</p>
      </div>
    </div>
    <div class="stat-card students">
      <div class="stat-icon"><i class="fas fa-user-graduate"></i></div>
      <div class="stat-content">
        <h3>{{ myStudents?.length || 0 }}</h3>
        <p>Students</p>
      </div>
    </div>
    <div class="stat-card repositories">
      <div class="stat-icon"><i class="fab fa-github"></i></div>
      <div class="stat-content">
        <h3>{{ myRepositories?.length || 0 }}</h3>
        <p>Repositories</p>
      </div>
    </div>
    <div class="stat-card repository-activity">
      <div class="stat-icon"><i class="fas fa-code-branch"></i></div>
      <div class="stat-content">
        <h3>{{ totalCommits }}</h3>
        <p>Total Commits</p>
      </div>
    </div>
    <div class="stat-card completion">
      <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
      <div class="stat-content">
        <h3>{{ taskCompletionRate }}%</h3>
        <p>Task Completion</p>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="taskCompletionRate"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Task Progress Section -->
  <div class="dashboard-card">
    <h2>Task Progress</h2>
    <div class="task-stats-container">
      <div class="task-overview">
        <div class="task-stat-card completed">
          <div class="task-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="task-info">
            <div class="task-number">{{ statistics.completedTasks }}</div>
            <div class="task-label">Completed Tasks</div>
          </div>
        </div>
        <div class="task-stat-card pending">
          <div class="task-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="task-info">
            <div class="task-number">{{ statistics.pendingTasks }}</div>
            <div class="task-label">Pending Tasks</div>
          </div>
        </div>
      </div>
      <div class="task-distribution">
        <h3>Task Distribution</h3>
        <div class="distribution-chart">
          <div *ngFor="let item of statistics.taskDistribution" 
               class="distribution-bar" 
               [style.width.%]="item.percentage"
               [style.background-color]="item.color">
            <span class="distribution-label">{{ item.status }}: {{ item.count }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Group Progress Section -->
  <div class="dashboard-card">
    <h2>Group Progress</h2>
    <div class="groups-progress-container">
      <div *ngFor="let group of statistics.groupProgress" class="group-progress-card">
        <div class="group-header">
          <div class="group-info">
            <h4>{{ group.groupName }}</h4>
            <p>{{ group.projectName }}</p>
          </div>
          <div class="group-stats">
            <span class="member-count">
              <i class="fas fa-users"></i>
              {{ group.memberCount }}
            </span>
          </div>
        </div>
        <div class="progress-info">
          <div class="progress-text">
            <span>{{ group.completedTasks }}/{{ group.totalTasks }} tasks completed</span>
            <span class="progress-percentage">{{ group.progress | number:'1.0-0' }}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" 
                 [style.width.%]="group.progress"
                 [style.background-color]="getProgressColor(group.progress)">
            </div>
          </div>
        </div>
        <div *ngIf="group.repositoryName" class="repository-info">
          <i class="fab fa-github"></i>
          <span>{{ group.repositoryName }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Repository Activity Section -->
  <div class="dashboard-card">
    <h2>Repository Activity</h2>
    <div class="repo-stats-container">
      <div class="repo-overview">
        <div class="repo-stat-item">
          <i class="fas fa-code-branch"></i>
          <div>
            <div class="repo-stat-number">{{ statistics.totalCommits }}</div>
            <div class="repo-stat-label">Total Commits</div>
          </div>
        </div>
      </div>
      <div class="repo-list">
        <div *ngFor="let repo of statistics.repositoryStats" class="repo-item">
          <div class="repo-info">
            <div class="repo-name">{{ repo.name }}</div>
            <div class="repo-meta">
              <span class="repo-language">{{ repo.language }}</span>
              <span class="repo-activity">{{ formatDate(repo.lastActivity) }}</span>
            </div>
          </div>
          <div class="repo-stats">
            <div class="repo-stat">
              <i class="fas fa-code-branch"></i>
              <span>{{ repo.commits }}</span>
            </div>
            <div class="repo-stat">
              <i class="fas fa-users"></i>
              <span>{{ repo.contributors }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Deadlines section (upcoming tasks) -->
  <div class="dashboard-row">
    <div class="dashboard-card deadlines-card">
      <div class="card-header">
        <h2><i class="fas fa-clock"></i> Upcoming Deadlines</h2>
      </div>
      <div class="card-content">
        <div *ngIf="myTasks.length === 0" class="empty-state">
          <i class="fas fa-calendar-check"></i>
          <p>No upcoming tasks</p>
        </div>
        <div *ngFor="let task of myTasks | slice:0:5" class="deadline-item">
          <div class="deadline-content">
            <h4>{{ task.title || task.name }}</h4>
            <div class="deadline-meta">
              <span class="deadline-date">
                <i class="fas fa-calendar"></i>
                {{ task.deadline | date:'shortDate' }}
              </span>
              <span class="deadline-status">
                <span class="status-badge">{{ task.status || 'To do' }}</span>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="dashboard-card actions-card">
      <div class="card-header">
        <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
      </div>
      <div class="card-content actions-list">
        <button class="action-btn" routerLink="../projects">Create Project</button>
        <button class="action-btn" routerLink="../tasks">Create Task</button>
        <button class="action-btn" routerLink="../groups">Create Group</button>
      </div>
    </div>

    <!-- Recent Notifications Widget -->
    <div class="dashboard-card notifications-card">
      <div class="card-header">
        <h2><i class="fas fa-bell"></i> Recent Notifications</h2>
      </div>
      <div class="card-content">
        <div *ngIf="recentNotifications.length === 0" class="empty-state">
          <i class="fas fa-bell-slash"></i>
          <p>No notifications</p>
        </div>
        <div *ngFor="let notif of recentNotifications" class="notification-item" [class.unread]="!notif.read">
          <div class="notification-icon">
            <i class="fas" [ngClass]="{
              'fa-folder-open': notif.type === 'project',
              'fa-tasks': notif.type === 'task',
              'fa-file-alt': notif.type === 'submission',
              'fa-bell': notif.type !== 'project' && notif.type !== 'task' && notif.type !== 'submission'
            }"></i>
          </div>
          <div class="notification-content">
            <p>{{ notif.message }}</p>
            <small>{{ notif.createdAt | date:'short' }}</small>
          </div>
          <div *ngIf="!notif.read" class="unread-indicator"></div>
        </div>
      </div>
    </div>

  </div>

</div>

<style>
.teacher-dashboard {
  max-width: 1200px;
  margin: 0 auto;
  padding: 24px;
}
.dashboard-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 24px;
}
.dashboard-card {
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.07);
  padding: 20px;
  flex: 1 1 320px;
  min-width: 280px;
}
.big-number {
  font-size: 2.5em;
  font-weight: bold;
  color: #1976d2;
  text-align: center;
}
.dashboard-loading, .dashboard-error {
  color: #b71c1c;
  font-weight: bold;
  margin: 20px 0;
}
.overdue-table {
  width: 100%;
  border-collapse: collapse;
}
.overdue-table th, .overdue-table td {
  border: 1px solid #eee;
  padding: 6px 10px;
  text-align: left;
}
.overdue-table th {
  background: #f5f5f5;
}
.overdue-table tr:nth-child(even) {
  background: #fafafa;
}
.overdue {
  color: #d32f2f;
  font-weight: bold;
}
</style>
